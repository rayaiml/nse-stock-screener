<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>NSE Screener</title>
<style>
body{font-family:system-ui;background:#0f172a;color:#e5e7eb;margin:0}
header{padding:12px;text-align:center;font-weight:600}
.filters{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
button{padding:10px 16px;border:none;border-radius:8px;background:#22c55e;font-weight:600}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{padding:8px;border-bottom:1px solid #334155;text-align:center}
#chart{height:420px;margin:10px}
</style>
</head>
<body>
<header>ðŸ“Š NSE Precomputed Stock Screener</header>

<div class="filters">
<label><input type="checkbox" id="adx" checked> ADX 22â€“30</label>
<label><input type="checkbox" id="macd" checked> MACD +</label>
<label><input type="checkbox" id="vol" checked> Volume &gt; Avg</label>
<button onclick="run()">Search</button>
</div>

<div id="out"></div>
<div id="chart"></div>

<script src="https://s3.tradingview.com/tv.js"></script>
<script>
const API = "https://nse-stock-screener.onrender.com";

function run(){
  const adx = document.getElementById("adx").checked;
  const macd = document.getElementById("macd").checked;
  const vol = document.getElementById("vol").checked;

  fetch(`${API}/screen?adx=${adx}&macd=${macd}&volume=${vol}`)
  .then(r=>r.json())
  .then(d=>{
    if(d.message){out.innerText=d.message;return;}
    let h="<table><tr><th>Stock</th><th>RSI</th><th>ADX</th><th>MACD</th><th>Vol</th><th>Avg</th><th>BB</th><th>Trend</th></tr>";
    d.forEach(s=>{
      h+=`<tr onclick="showChart('${s.symbol}')">
        <td>${s.symbol}</td><td>${s.rsi}</td><td>${s.adx}</td>
        <td>${s.macd_above_signal?'Yes':'No'}</td>
        <td>${s.current_volume}</td><td>${s.avg_volume_21}</td>
        <td>${s.price} (${s.bb_position})</td><td>${s.trend}</td>
      </tr>`;
    });
    out.innerHTML=h+"</table>";
  });
}

function showChart(sym){
  document.getElementById("chart").innerHTML="";
  new TradingView.widget({
    container_id:"chart",
    symbol:"NSE:"+sym,
    interval:"D",
    theme:"dark",
    indicators:true,
    studies:["EMA@tv-basicstudies","MACD@tv-basicstudies","RSI@tv-basicstudies","BB@tv-basicstudies","ADX@tv-basicstudies"]
  });
}
</script>
</body>
</html>
